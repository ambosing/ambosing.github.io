{"componentChunkName":"component---src-templates-post-template-tsx","path":"/docker/docker_compose_volumes_establish_kafka/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2 id=\"하게-된-이유\" style=\"position:relative;\"><a href=\"#%ED%95%98%EA%B2%8C-%EB%90%9C-%EC%9D%B4%EC%9C%A0\" aria-label=\"하게 된 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하게 된 이유</h2>\n<p>카프카를 배워보려고 강의를 듣다가 VirtualBox와 Ubuntu로 설치하는 것이 힘들어보여서 Docker로 설치하였습니다.</p>\n<p>그러다 보니 강의 개발 환경과 많이 달라졌었는데요. 강의에서 Kafka Log를 보는 일도 있다고 해서 이 때마다 로그를 확인하러 가기가 너무 시간이 오래 걸릴 것 같아서 로그를 docker bindmount을 사용해 로컬에서 바로 볼 수 있도록 해보겠습니다.</p>\n<h2 id=\"해결-과정\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95\" aria-label=\"해결 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 과정</h2>\n<p>먼저 로컬에 logs라는 디렉터리를 먼저 만들어줬습니다.</p>\n<p><code class=\"language-text\">mkdir logs</code></p>\n<p>이제 이 디렉토리를 도커 안에 있는 kafka log가 쌓이는 폴더와 연결해주겠습니다.</p>\n<p>그러려면 일단 <code class=\"language-text\">confluentinc/cp-kafka</code> 이 이미지 안에 어디에 로그가 쌓이는지 알아야 하는데요.</p>\n<p>구글링 후에 <code class=\"language-text\">/var/lib/kafka/data</code> 여기에 쌓인다는 걸 알게 되었습니다.\n그럼 이제 docker compose 파일을 수정해주도록 하겠습니다!</p>\n<div class=\"code-header\">\n\t<span class=\"red btn\"></span>\n\t<span class=\"yellow btn\"></span>\n\t<span class=\"green btn\"></span>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">zookeeper</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> confluentinc/cp<span class=\"token punctuation\">-</span>zookeeper<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ZOOKEEPER_SERVER_ID</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">ZOOKEEPER_CLIENT_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2181</span>\n      <span class=\"token key atrule\">ZOOKEEPER_TICK_TIME</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2000</span>\n      <span class=\"token key atrule\">ZOOKEEPER_INIT_LIMIT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n      <span class=\"token key atrule\">ZOOKEEPER_SYNC_LIMIT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"22181:2181\"</span>\n\n  <span class=\"token key atrule\">kafka</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> confluentinc/cp<span class=\"token punctuation\">-</span>kafka<span class=\"token punctuation\">:</span>7.1.2\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> zookeeper\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"29092:29092\"</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">KAFKA_BROKER_ID</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">KAFKA_ZOOKEEPER_CONNECT</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'zookeeper:2181'</span>\n      <span class=\"token key atrule\">KAFKA_ADVERTISED_LISTENERS</span><span class=\"token punctuation\">:</span> PLAINTEXT<span class=\"token punctuation\">:</span>//kafka<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>PLAINTEXT_HOST<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">29092</span>\n      <span class=\"token key atrule\">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span class=\"token punctuation\">:</span> PLAINTEXT<span class=\"token punctuation\">:</span>PLAINTEXT<span class=\"token punctuation\">,</span>PLAINTEXT_HOST<span class=\"token punctuation\">:</span>PLAINTEXT\n      <span class=\"token key atrule\">KAFKA_INTER_BROKER_LISTENER_NAME</span><span class=\"token punctuation\">:</span> PLAINTEXT\n      <span class=\"token key atrule\">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token comment\"># 이부분 추가</span>\n\t\t<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./logs<span class=\"token punctuation\">:</span>/var/lib/kafka/data</code></pre></div>\n<p>이렇게 도커 컴포즈를 띄워보면..</p>\n<p>아래와 같은 에러가 발생합니다..!<br>\n<strong><a href=\"https://stackoverflow.com/questions/75499821/command-usr-local-bin-dub-path-var-lib-kafka-data-writable-failed-in-kafka\" target=\"_blank\" rel=\"nofollow\">Command [/usr/local/bin/dub path /var/lib/kafka/data writable] FAILED ! in Kafka</a></strong></p>\n<p>해결 방법을 모색한 결과, root 권한을 넣어주면 잘 된다는 얘기가 있어서</p>\n<p>아래와 같이 Root 권한을 추가해주었습니다.</p>\n<p><strong>Root 권한을 추가한 docker compose 파일</strong></p>\n<div class=\"code-header\">\n\t<span class=\"red btn\"></span>\n\t<span class=\"yellow btn\"></span>\n\t<span class=\"green btn\"></span>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">zookeeper</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> confluentinc/cp<span class=\"token punctuation\">-</span>zookeeper<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ZOOKEEPER_SERVER_ID</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">ZOOKEEPER_CLIENT_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2181</span>\n      <span class=\"token key atrule\">ZOOKEEPER_TICK_TIME</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2000</span>\n      <span class=\"token key atrule\">ZOOKEEPER_INIT_LIMIT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n      <span class=\"token key atrule\">ZOOKEEPER_SYNC_LIMIT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"22181:2181\"</span>\n\n  <span class=\"token key atrule\">kafka</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> confluentinc/cp<span class=\"token punctuation\">-</span>kafka<span class=\"token punctuation\">:</span>7.1.2\n\t\t<span class=\"token comment\"># Root 권한 </span>\n    <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> zookeeper\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"29092:29092\"</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">KAFKA_BROKER_ID</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">KAFKA_ZOOKEEPER_CONNECT</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'zookeeper:2181'</span>\n      <span class=\"token key atrule\">KAFKA_ADVERTISED_LISTENERS</span><span class=\"token punctuation\">:</span> PLAINTEXT<span class=\"token punctuation\">:</span>//kafka<span class=\"token punctuation\">:</span><span class=\"token number\">9092</span><span class=\"token punctuation\">,</span>PLAINTEXT_HOST<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">29092</span>\n      <span class=\"token key atrule\">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span class=\"token punctuation\">:</span> PLAINTEXT<span class=\"token punctuation\">:</span>PLAINTEXT<span class=\"token punctuation\">,</span>PLAINTEXT_HOST<span class=\"token punctuation\">:</span>PLAINTEXT\n      <span class=\"token key atrule\">KAFKA_INTER_BROKER_LISTENER_NAME</span><span class=\"token punctuation\">:</span> PLAINTEXT\n      <span class=\"token key atrule\">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token comment\"># Docker bindmount</span>\n\t\t<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./logs<span class=\"token punctuation\">:</span>/var/lib/kafka/data</code></pre></div>\n<p>이제 잘 되더군요!<br>\n<code class=\"language-text\">docker compose up</code>을 통해 이제 도커 컨테이너를 띄우고 logs 디렉터리를 확인해보겠습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/25f5559428bbf56248d28901f6fa47e6/fab06/2023-08-31-22-13-18.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.020833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRkAAAABXRUJQVlA4IDQAAADwAgCdASoUAAgAPtFUo0uoJKMhsAgBABoJaWkfADdYAAD+8YnLISh82LwupIXsY0GvUgAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/25f5559428bbf56248d28901f6fa47e6/a59e9/2023-08-31-22-13-18.webp 192w,\n/static/25f5559428bbf56248d28901f6fa47e6/0ca9f/2023-08-31-22-13-18.webp 384w,\n/static/25f5559428bbf56248d28901f6fa47e6/dc9b9/2023-08-31-22-13-18.webp 768w,\n/static/25f5559428bbf56248d28901f6fa47e6/e2c2f/2023-08-31-22-13-18.webp 1152w,\n/static/25f5559428bbf56248d28901f6fa47e6/f3efb/2023-08-31-22-13-18.webp 1536w,\n/static/25f5559428bbf56248d28901f6fa47e6/fab06/2023-08-31-22-13-18.webp 2000w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/25f5559428bbf56248d28901f6fa47e6/a59e9/2023-08-31-22-13-18.webp 192w,\n/static/25f5559428bbf56248d28901f6fa47e6/0ca9f/2023-08-31-22-13-18.webp 384w,\n/static/25f5559428bbf56248d28901f6fa47e6/dc9b9/2023-08-31-22-13-18.webp 768w,\n/static/25f5559428bbf56248d28901f6fa47e6/e2c2f/2023-08-31-22-13-18.webp 1152w,\n/static/25f5559428bbf56248d28901f6fa47e6/f3efb/2023-08-31-22-13-18.webp 1536w,\n/static/25f5559428bbf56248d28901f6fa47e6/fab06/2023-08-31-22-13-18.webp 2000w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/25f5559428bbf56248d28901f6fa47e6/dc9b9/2023-08-31-22-13-18.webp\"\n            alt=\"2023 08 31 22 13 18\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>잘 들어가 있습니다!!</p>\n<h2 id=\"배운-점\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%EC%9A%B4-%EC%A0%90\" aria-label=\"배운 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배운 점</h2>\n<ul>\n<li>docker compose에 root 권한을 줄 수 있습니다.</li>\n<li>docker compose에 docker bindmount을 추가하는 방법을 깨달았습니다.</li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#%ED%95%98%EA%B2%8C-%EB%90%9C-%EC%9D%B4%EC%9C%A0\">하게 된 이유</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95\">해결 과정</a></li>\n<li><a href=\"#%EB%B0%B0%EC%9A%B4-%EC%A0%90\">배운 점</a></li>\n</ul>","frontmatter":{"title":"Docker compose로 띄운 Kafka Log를 docker bindmount 사용해서 로컬에서 보기","summary":"Docker!!!!!!!!!!! 너무 편해요..!","date":"2023.08.31.","categories":["Docker","Kafka"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRvwAAABXRUJQVlA4IPAAAACwBQCdASoUABQAAAAAJaQDLs2AOAA6RjyVZ4AcyT+M2igZIByhf9q/KHjK/0zOzXrCCarYswAA/v//vi4vw/8C9ZQ7H+H//yCwbQPvsZtVP/0ES//obRwOWqfhB6QluKlBWVv/00//+CZuyt2HnR8rj3PH4g+AF7BjHL/DERmaNf+iMa2Vn/8w5vZ6J8f/zWL84nce2QIW+sKRZGr/3/++a+72/AQG7P0f+Vx+2n8ZbXOmM113LcubNJdYTmvhHp8ioh/Ssay6McI8Hv4WzVhoxfjdbd0Vnn7uGhnuuiz+QfZ5Lvn/yafX9rRFNCCAAAA="},"images":{"fallback":{"src":"/static/97afc7f825b0ddb0803e2cd1be787df7/9c0a1/chocoball.webp","srcSet":"/static/97afc7f825b0ddb0803e2cd1be787df7/e64f1/chocoball.webp 100w,\n/static/97afc7f825b0ddb0803e2cd1be787df7/8b00d/chocoball.webp 200w,\n/static/97afc7f825b0ddb0803e2cd1be787df7/9c0a1/chocoball.webp 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[]},"width":400,"height":400}},"publicURL":"/static/97afc7f825b0ddb0803e2cd1be787df7/chocoball.webp"}}}}]}},"pageContext":{"slug":"/docker/docker_compose_volumes_establish_kafka/"}},"staticQueryHashes":["2269898903"],"slicesMap":{}}