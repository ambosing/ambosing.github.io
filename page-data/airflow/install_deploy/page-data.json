{"componentChunkName":"component---src-templates-post-template-tsx","path":"/airflow/install_deploy/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2 id=\"들어가기-전에\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84%EC%97%90\" aria-label=\"들어가기 전에 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가기 전에</h2>\n<p>저는 회사에서 데이터를 배치하는 작업을 많이 했었습니다. 그 중에 처음으로 도전한 것은 바로 예전 학생 때 프로젝트했던 Linux Cron 배치 작업으로 배치 데이터를 프로세싱 중이었는데요.<br>\n이것보다 더 좋은 것이 없을까하는 생각이 매번 들긴 했었습니다. 그 당시에만 해도 모든 서버를 온프레미스로 돌리고 있는 상황이었습니다!<br>\n이렇게 하다보니 컴퓨터가 꺼지거나 배치 작업이 돌아가지 않을 때는 운영팀의 보고를 통해서만 받게 되었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e373f73b0c15e7a4d4d103a7b40c30e5/84f9f/2023-08-01-14-59-32.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.770833333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRmwAAABXRUJQVlA4IGAAAACwAwCdASoUAAYAPtFWpEuoJKOhsAgBABoJZwAD42IN75/p79QgAAD+x1/zRYSa57p4jh/afp/nnBFwmOoC21xjSIbzjxbAyXE2KPq1Hl526FBCb910qRqZyBDn04AAAAA='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e373f73b0c15e7a4d4d103a7b40c30e5/a59e9/2023-08-01-14-59-32.webp 192w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/0ca9f/2023-08-01-14-59-32.webp 384w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/dc9b9/2023-08-01-14-59-32.webp 768w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/e2c2f/2023-08-01-14-59-32.webp 1152w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/f3efb/2023-08-01-14-59-32.webp 1536w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/84f9f/2023-08-01-14-59-32.webp 1552w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e373f73b0c15e7a4d4d103a7b40c30e5/a59e9/2023-08-01-14-59-32.webp 192w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/0ca9f/2023-08-01-14-59-32.webp 384w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/dc9b9/2023-08-01-14-59-32.webp 768w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/e2c2f/2023-08-01-14-59-32.webp 1152w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/f3efb/2023-08-01-14-59-32.webp 1536w,\n/static/e373f73b0c15e7a4d4d103a7b40c30e5/84f9f/2023-08-01-14-59-32.webp 1552w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e373f73b0c15e7a4d4d103a7b40c30e5/dc9b9/2023-08-01-14-59-32.webp\"\n            alt=\"기존이미지\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<div class=\"source\"> 온프레미스 당시 인프라</div>\n<p>회사에서 AWS 사용해보기로 결정이 됐습니다.  기존에 있던 배치 시스템을 변경할 기회였습니다.<br>\n그래서 AWS에서 배치 작업을 더 좋게 처리하는 방법이 없을까하다가 Lambda + EventBridge로 처리하게 했었습니다.<br>\n이번엔 Severless 서비스인 Lambda를 사용하니깐 컴퓨터가 문제일 경우는 없었습니다만 만약 데이터의 정합성의 문제로 에러가 발생한다면 기존의 배치 작업을 다시 돌려야하는 문제가 생겼습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1b85444b25498e5002dd7c6d234316e8/da9ed/2023-08-01-15-56-08.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRmwAAABXRUJQVlA4IGAAAADQAwCdASoUAAgAPtFipk0oJiOiMAgBABoJQApgWZQEz6JrwXASOgAA/v5hO5mI8DVfEvop7ZGEBe06CFhYaRQZ6cixN64DP4iBpz1nABoSE4WnMxHURDXEvyP7A3paAAA='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1b85444b25498e5002dd7c6d234316e8/a59e9/2023-08-01-15-56-08.webp 192w,\n/static/1b85444b25498e5002dd7c6d234316e8/0ca9f/2023-08-01-15-56-08.webp 384w,\n/static/1b85444b25498e5002dd7c6d234316e8/dc9b9/2023-08-01-15-56-08.webp 768w,\n/static/1b85444b25498e5002dd7c6d234316e8/e2c2f/2023-08-01-15-56-08.webp 1152w,\n/static/1b85444b25498e5002dd7c6d234316e8/da9ed/2023-08-01-15-56-08.webp 1277w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1b85444b25498e5002dd7c6d234316e8/a59e9/2023-08-01-15-56-08.webp 192w,\n/static/1b85444b25498e5002dd7c6d234316e8/0ca9f/2023-08-01-15-56-08.webp 384w,\n/static/1b85444b25498e5002dd7c6d234316e8/dc9b9/2023-08-01-15-56-08.webp 768w,\n/static/1b85444b25498e5002dd7c6d234316e8/e2c2f/2023-08-01-15-56-08.webp 1152w,\n/static/1b85444b25498e5002dd7c6d234316e8/da9ed/2023-08-01-15-56-08.webp 1277w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1b85444b25498e5002dd7c6d234316e8/dc9b9/2023-08-01-15-56-08.webp\"\n            alt=\"2023 08 01 15 56 08\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<div class=\"source\"> AWS 당시 인프라</div>\n<p>그러다가 데이터 엔지니어링에 대해 관심을 가지고 있었습니다. 그 중 Airflow라는 기술이 있었는데요. Airflow는 이전에 했던 배치 시스템의 단점들을 보완하고 있었습니다..!<br>\n그래서 이번 글에서는 Airflow를 설치하는 방법과 Git Action으로 AWS EC2에 배포하는 방법을 알아보겠습니다.<br>\n<del>왜 AWS EC2냐고 하면 .. 제가 쓰고 있는 환경이라서..</del></p>\n<h4 id=\"참고한-글\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%ED%95%9C-%EA%B8%80\" aria-label=\"참고한 글 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고한 글</h4>\n<p><a href=\"https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html\" target=\"_blank\" rel=\"nofollow\">Airflow 공식문서</a></p>\n<h2 id=\"docker-compose로-airflow-설치하기\" style=\"position:relative;\"><a href=\"#docker-compose%EB%A1%9C-airflow-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\" aria-label=\"docker compose로 airflow 설치하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker compose로 Airflow 설치하기</h2>\n<p>저는 Docker compose로 로컬(윈도우)에 설치를 해주었습니다. 로컬 설치과정은 쉽기 때문에 이번 설치 과정은 Amazon linux 환경에서 진행된다는 점을 알고계시면 좋을 것 같습니다. Docker compose로 설치를 진행하도록 하겠습니다!</p>\n<h4 id=\"amazon-linux2-환경에서-docker-설치하기\" style=\"position:relative;\"><a href=\"#amazon-linux2-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-docker-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\" aria-label=\"amazon linux2 환경에서 docker 설치하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Amazon linux2 환경에서 Docker 설치하기</h4>\n<p>Amazone-linux2에 도커를 설치합니다.<br>\nsudo는 언제나 필수입니다! (안그러면 권한 없다고 에러를 냅니다! ㅠㅠ)</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> amazon-linux-extras <span class=\"token function\">install</span> <span class=\"token function\">docker</span></code></pre></div>\n<p>그런 다음 도커를 시작합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> <span class=\"token function\">service</span> <span class=\"token function\">docker</span> start</code></pre></div>\n<p>현재 사용자를 docker 그룹에 추가합니다. 이를 통해 sudo를 사용하지 않고도 Docker를 실행할 수 있습니다</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-aG</span> <span class=\"token function\">docker</span> <span class=\"token environment constant\">$USER</span></code></pre></div>\n<h4 id=\"amazon-linux2에서-docker-compose-설치\" style=\"position:relative;\"><a href=\"#amazon-linux2%EC%97%90%EC%84%9C-docker-compose-%EC%84%A4%EC%B9%98\" aria-label=\"amazon linux2에서 docker compose 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Amazon linux2에서 Docker Compose 설치</h4>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> <span class=\"token string\">\"https://github.com/docker/compose/releases/latest/download/docker-compose-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">)</span></span>-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token parameter variable\">-o</span> /usr/local/bin/docker-compose</code></pre></div>\n<p>실행 권한을 부여해줍니다</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</code></pre></div>\n<p>도커 컴포즈가 잘 설치되었는지 확인해봅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">docker-compose</span> <span class=\"token parameter variable\">--version</span></code></pre></div>\n<p>윈도우에서는 <code class=\"language-text\">docker compose</code>이었는데 리눅스에서는 <code class=\"language-text\">docker-compose</code>입니다!</p>\n<h4 id=\"github-repository를-하나-생성\" style=\"position:relative;\"><a href=\"#github-repository%EB%A5%BC-%ED%95%98%EB%82%98-%EC%83%9D%EC%84%B1\" aria-label=\"github repository를 하나 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Github Repository를 하나 생성</h4>\n<p>Github에 들어가 먼저 Repository를 하나 생성해줍니다.<br>\n저는 Airflow라고 먼저 해주었습니다!</p>\n<p>그런 다음 amazon linux에 Git을 설치합니다.</p>\n<ul>\n<li>아래 명령을 실행해 yum을 업데이트 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> yum update</code></pre></div>\n<ul>\n<li>명령어를 실행해 git을 설치합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> <span class=\"token function\">git</span></code></pre></div>\n<ul>\n<li>마지막으로 git이 잘 설치되었는지 확인합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> version</code></pre></div>\n<p>이제 아까 만들었던 Git Repository를 Clone 받습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>Git 주소<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"amazon-linux2에-docker-compose로-airflow-설치하기\" style=\"position:relative;\"><a href=\"#amazon-linux2%EC%97%90-docker-compose%EB%A1%9C-airflow-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\" aria-label=\"amazon linux2에 docker compose로 airflow 설치하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Amazon-linux2에 Docker-compose로 Airflow 설치하기</h4>\n<p>먼저 Airflow 폴더를 만들고 폴더에서 작업하겠습니다.<br>\n저는 GitRepository 이름이 airflow라고 가정하겠습니다.<br>\ncurl 명령어를 통해 docker-compose.yaml 파일을 fetching해 주겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">mkdir</span> airflow\n<span class=\"token builtin class-name\">cd</span> airflow\n\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-LfO</span> <span class=\"token string\">'https://airflow.apache.org/docs/apache-airflow/2.6.3/docker-compose.yaml'</span></code></pre></div>\n<p>이렇게 진행하면 현재 진행한 폴더에 yaml 파일이 생기실 겁니다!<br>\ndocker-compose에 포함되어 있는 기능은 이렇습니다.</p>\n<ul>\n<li><strong>airflow-scheduler</strong> : 모든 DAG와 task들을 모니터링합니다. task들의 종속성들이 완료되면 task들을 트리거 시킵니다.</li>\n<li><strong>airflow-webserver</strong> : airflow를 UI로 볼수 있는 웹사이트입니다. 기본적으로 URL은 <a href=\"http://localhost:8080\" target=\"_blank\" rel=\"nofollow\">http://localhost:8080</a> 입니다.</li>\n<li><strong>airflow-worker</strong> : 스케줄러가 부여한 작업을 실행하는 작업자입니다.</li>\n<li><strong>airflow-triggerer</strong> : Triggerer는 연기 가능한 작업에 대한 이벤트 루프를 실행합니다.</li>\n<li><strong>airflow-init</strong> : airflow 서비스를 초기화합니다.</li>\n<li><strong>postgres</strong></li>\n<li><strong>redis</strong></li>\n</ul>\n<p>이외에도 flower는 있지만 이건 설명을 넘어가겠습니다!<br>\n또한, 몇 개의 디렉토리는 컨테이너에 마운트됩니다. 그래서 정해진 디렉토리는 컨테이너와 동기화됩니다.</p>\n<ul>\n<li><strong>./dags</strong> : DAG 파일을 여기에 놓으면 Airflow에서 인식합니다.</li>\n<li><strong>./logs</strong> : 스케줄러와 task 실행한 로그들이 담깁니다.</li>\n<li><strong>./config</strong> : 커스텀한 log parser를 추가할 수 있습니다. 그리고 airflow_local_settings.py를 추가하여 클러스터 정책을 구성할 수 있습니다.</li>\n<li><strong>./plugins</strong> : 커스텀한 plugin들을 여가에 추가할 수 있습니다.</li>\n</ul>\n<p>그래서 위와 같은 디렉토리들은 필수적으로 구성되어야 합니다.<br>\n폴더들을 모두 만들어줍시다!</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> ./dags ./logs ./plugins ./config\n<span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"AIRFLOW_UID=<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> <span class=\"token parameter variable\">-u</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">></span> .env</code></pre></div>\n<p>다른 OS에서는 이렇게 진행했을 때 경고가 나올 수도 있습니다.<br>\n그럴 때는 따로 .env 파일을 추가하여</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token assign-left variable\">AIRFLOW_UID</span><span class=\"token operator\">=</span><span class=\"token number\">50000</span></code></pre></div>\n<p>이제 docker compose 명령어를 사용하여 airflow를 설치해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># Linux, mac</span>\n<span class=\"token function\">docker-compose</span> up airflow-init\n<span class=\"token comment\"># window</span>\n<span class=\"token function\">docker</span> compose up airflow-init</code></pre></div>\n<p>docker compose가 초기화 되면 이런 메시지를 보실 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">airflow-init_1       | Upgrades done\nairflow-init_1       | Admin user airflow created\nairflow-init_1       | 2.6.3\nstart_airflow-init_1 exited with code 0</code></pre></div>\n<p>그리고 웹에 로그인할 계정이 만들어집니다.<br>\nid : <code class=\"language-text\">airflow</code><br>\npw : <code class=\"language-text\">airflow</code></p>\n<p>이제 모든 docker compose로 설치한 모든 서비스를 시작해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># Linux, mac</span>\n<span class=\"token function\">docker-compose</span> up \n<span class=\"token comment\"># window</span>\n<span class=\"token function\">docker</span> compose up </code></pre></div>\n<p>정상적으로 잘 동작했는지 docker ps 명령어를 통해 알아봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span>\nCONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS                    PORTS                              NAMES\n247ebe6cf87a   apache/airflow:2.6.3   <span class=\"token string\">\"/usr/bin/dumb-init …\"</span>   <span class=\"token number\">3</span> minutes ago    Up <span class=\"token number\">3</span> minutes <span class=\"token punctuation\">(</span>healthy<span class=\"token punctuation\">)</span>    <span class=\"token number\">8080</span>/tcp                           compose_airflow-worker_1\ned9b09fc84b1   apache/airflow:2.6.3   <span class=\"token string\">\"/usr/bin/dumb-init …\"</span>   <span class=\"token number\">3</span> minutes ago    Up <span class=\"token number\">3</span> minutes <span class=\"token punctuation\">(</span>healthy<span class=\"token punctuation\">)</span>    <span class=\"token number\">8080</span>/tcp                           compose_airflow-scheduler_1\n7cb1fb603a98   apache/airflow:2.6.3   <span class=\"token string\">\"/usr/bin/dumb-init …\"</span>   <span class=\"token number\">3</span> minutes ago    Up <span class=\"token number\">3</span> minutes <span class=\"token punctuation\">(</span>healthy<span class=\"token punctuation\">)</span>    <span class=\"token number\">0.0</span>.0.0:8080-<span class=\"token operator\">></span><span class=\"token number\">8080</span>/tcp             compose_airflow-webserver_1\n74f3bbe506eb   postgres:13            <span class=\"token string\">\"docker-entrypoint.s…\"</span>   <span class=\"token number\">18</span> minutes ago   Up <span class=\"token number\">17</span> minutes <span class=\"token punctuation\">(</span>healthy<span class=\"token punctuation\">)</span>   <span class=\"token number\">5432</span>/tcp                           compose_postgres_1\n0bd6576d23cb   redis:latest           <span class=\"token string\">\"docker-entrypoint.s…\"</span>   <span class=\"token number\">10</span> hours ago     Up <span class=\"token number\">17</span> minutes <span class=\"token punctuation\">(</span>healthy<span class=\"token punctuation\">)</span>   <span class=\"token number\">0.0</span>.0.0:6379-<span class=\"token operator\">></span><span class=\"token number\">6379</span>/tcp             compose_redis_1</code></pre></div>\n<p>status에 보면 정상적인 서비스들은 healthy라고 나오게 됩니다.<br>\n그런다음에 이제 <a href=\"http://localhost:8080\" target=\"_blank\" rel=\"nofollow\">http://localhost:8080</a> 으로 들어가시게 되면 아래와 같이 로그인 창이 뜹니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/64f1d4cde6de05bdc60172dceec540a7/fad02/2023-08-07-14-29-41.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRkAAAABXRUJQVlA4IDQAAACwAgCdASoUAAcAPtFUpEuoJKOhsAgBABoJaQAAeyAA/vJUrzl2CkiQQ8VwxE0X8z7VsBAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/64f1d4cde6de05bdc60172dceec540a7/a59e9/2023-08-07-14-29-41.webp 192w,\n/static/64f1d4cde6de05bdc60172dceec540a7/0ca9f/2023-08-07-14-29-41.webp 384w,\n/static/64f1d4cde6de05bdc60172dceec540a7/dc9b9/2023-08-07-14-29-41.webp 768w,\n/static/64f1d4cde6de05bdc60172dceec540a7/e2c2f/2023-08-07-14-29-41.webp 1152w,\n/static/64f1d4cde6de05bdc60172dceec540a7/f3efb/2023-08-07-14-29-41.webp 1536w,\n/static/64f1d4cde6de05bdc60172dceec540a7/fad02/2023-08-07-14-29-41.webp 2539w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/64f1d4cde6de05bdc60172dceec540a7/a59e9/2023-08-07-14-29-41.webp 192w,\n/static/64f1d4cde6de05bdc60172dceec540a7/0ca9f/2023-08-07-14-29-41.webp 384w,\n/static/64f1d4cde6de05bdc60172dceec540a7/dc9b9/2023-08-07-14-29-41.webp 768w,\n/static/64f1d4cde6de05bdc60172dceec540a7/e2c2f/2023-08-07-14-29-41.webp 1152w,\n/static/64f1d4cde6de05bdc60172dceec540a7/f3efb/2023-08-07-14-29-41.webp 1536w,\n/static/64f1d4cde6de05bdc60172dceec540a7/fad02/2023-08-07-14-29-41.webp 2539w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/64f1d4cde6de05bdc60172dceec540a7/dc9b9/2023-08-07-14-29-41.webp\"\n            alt=\"airflow 화면\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n그리고 로그인을 하고 나면 이러한 example DAGs가 존재합니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a5fa026affac6522d8ad3b418fbd31f2/58bdf/2023-08-24-09-20-12.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.22916666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAACwAgCdASoUAAkAPtFUo0uoJKMhsAgBABoJaQAAeyAA/vG8UfVX4mABsyU7ODyAAAA='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a5fa026affac6522d8ad3b418fbd31f2/a59e9/2023-08-24-09-20-12.webp 192w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/0ca9f/2023-08-24-09-20-12.webp 384w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/dc9b9/2023-08-24-09-20-12.webp 768w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/e2c2f/2023-08-24-09-20-12.webp 1152w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/f3efb/2023-08-24-09-20-12.webp 1536w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/58bdf/2023-08-24-09-20-12.webp 2340w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a5fa026affac6522d8ad3b418fbd31f2/a59e9/2023-08-24-09-20-12.webp 192w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/0ca9f/2023-08-24-09-20-12.webp 384w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/dc9b9/2023-08-24-09-20-12.webp 768w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/e2c2f/2023-08-24-09-20-12.webp 1152w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/f3efb/2023-08-24-09-20-12.webp 1536w,\n/static/a5fa026affac6522d8ad3b418fbd31f2/58bdf/2023-08-24-09-20-12.webp 2340w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a5fa026affac6522d8ad3b418fbd31f2/dc9b9/2023-08-24-09-20-12.webp\"\n            alt=\"airflow example DAGs\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n엄청나게 많은 example DAGs가 보이는데요. 만약 example DAGs가 필요없다면 제거해줄 수 있습니다.</p>\n<p>docker-compose.yml 파일에서 AIRFLOW__CORE__LOAD_EXAMPLES가 true로 설정돼있는 것을 false로 변경하였습니다.<br>\n<code class=\"language-text\">AIRFLOW__CORE__LOAD_EXAMPLES: 'false'</code></p>\n<p>그러고 나면 DAGs 페이지에 example DAG들이 모두 사라진 걸 알 수 있습니다.\n이로써 일단 EC2에 Docker Compose를 사용해서 Airflow를 띄웠습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 627px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/585e10669a034ff6775a6e693af81345/faefd/2023-08-24-11-07-24.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 128.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRtwAAABXRUJQVlA4INAAAACwBACdASoUABoAPtFaqU2oJSQiKAqpABoJQBhoAqpXge1obNZGpp5vc1RU2koAAP7wrq+UZOlF+0/YQkTXSGSHkuiQTuyVM+CtVlFdt/y5V0bD52nM9xg6JpngUd0Pe9e+9HVQZrL39+gQaJDKNLYd8fCwsLhubz6byUREfsmaX6sPsRsXtQ+TtsiY4QXfPuYV22Vbde3gREy5L0icKlPnD8FTUStxinDauNBt9NyRHvUSVWkpAN9ioGStXFf2U9bcWBx2HnwRtB+RkosoAAAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/585e10669a034ff6775a6e693af81345/a59e9/2023-08-24-11-07-24.webp 192w,\n/static/585e10669a034ff6775a6e693af81345/0ca9f/2023-08-24-11-07-24.webp 384w,\n/static/585e10669a034ff6775a6e693af81345/faefd/2023-08-24-11-07-24.webp 627w\"\n              sizes=\"(max-width: 627px) 100vw, 627px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/585e10669a034ff6775a6e693af81345/a59e9/2023-08-24-11-07-24.webp 192w,\n/static/585e10669a034ff6775a6e693af81345/0ca9f/2023-08-24-11-07-24.webp 384w,\n/static/585e10669a034ff6775a6e693af81345/faefd/2023-08-24-11-07-24.webp 627w\"\n            sizes=\"(max-width: 627px) 100vw, 627px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/585e10669a034ff6775a6e693af81345/faefd/2023-08-24-11-07-24.webp\"\n            alt=\"2023 08 24 11 07 24\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<div class=\"source\"> 현재 구축한 인프라 </div>\n<p>이제 EC2에는 모두 설정을 해놓았으니 Github Action을 통해 배포자동화를 시켜보겠습니다.</p>\n<h2 id=\"git-action-배포-자동화\" style=\"position:relative;\"><a href=\"#git-action-%EB%B0%B0%ED%8F%AC-%EC%9E%90%EB%8F%99%ED%99%94\" aria-label=\"git action 배포 자동화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Git Action 배포 자동화</h2>\n<p>먼저 Git Action에서 EC2를 접근하기 위해서는 SSH 키와 HOST Address가 필요합니다.<br>\n이를 먼저 안전하게 저장하기 위해 Github Secrets로 저장해봅시다.</p>\n<p>Github에 접속해 Airflow파일들이 담겨있는 Repository를 선택합니다.<br>\n그런 다음 아래와 같이 github settings 클릭합니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/670fa4c6b628b7fdf1b563ba48345e26/bf53a/2023-08-25-09-10-13.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 5.208333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAACwAgCdASoUAAEAPtFWpEuoJKOhsAgBABoJaQAAeyAA/vDxbWZnaVdC59m5wbcUAAA='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/670fa4c6b628b7fdf1b563ba48345e26/a59e9/2023-08-25-09-10-13.webp 192w,\n/static/670fa4c6b628b7fdf1b563ba48345e26/0ca9f/2023-08-25-09-10-13.webp 384w,\n/static/670fa4c6b628b7fdf1b563ba48345e26/dc9b9/2023-08-25-09-10-13.webp 768w,\n/static/670fa4c6b628b7fdf1b563ba48345e26/bf53a/2023-08-25-09-10-13.webp 1131w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/670fa4c6b628b7fdf1b563ba48345e26/a59e9/2023-08-25-09-10-13.webp 192w,\n/static/670fa4c6b628b7fdf1b563ba48345e26/0ca9f/2023-08-25-09-10-13.webp 384w,\n/static/670fa4c6b628b7fdf1b563ba48345e26/dc9b9/2023-08-25-09-10-13.webp 768w,\n/static/670fa4c6b628b7fdf1b563ba48345e26/bf53a/2023-08-25-09-10-13.webp 1131w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/670fa4c6b628b7fdf1b563ba48345e26/dc9b9/2023-08-25-09-10-13.webp\"\n            alt=\"2023 08 25 09 10 13\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Settings에 들어오면 메인화면 좌측에 메뉴가 나옵니다.<br>\n여기서 빨간색으로 칠해진 버튼을 누르면 드롭다운이 됩니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 425px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/499f4eef4bc763868e975acb3e812e61/b5bcc/2023-08-25-09-19-36.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.39583333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRm4AAABXRUJQVlA4IGIAAABwBACdASoUACwAPtFep0+oJSMiJWsxABoJaQAAKeV8llx+IP1B8O0bDBBgAAD+8hexqy3tDmlp4gueylMrjLPu9BUVOunba2CB8ZsoE5kW1WpGiJxRVIzz4Kn5wuKvsAAAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/499f4eef4bc763868e975acb3e812e61/a59e9/2023-08-25-09-19-36.webp 192w,\n/static/499f4eef4bc763868e975acb3e812e61/0ca9f/2023-08-25-09-19-36.webp 384w,\n/static/499f4eef4bc763868e975acb3e812e61/b5bcc/2023-08-25-09-19-36.webp 425w\"\n              sizes=\"(max-width: 425px) 100vw, 425px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/499f4eef4bc763868e975acb3e812e61/a59e9/2023-08-25-09-19-36.webp 192w,\n/static/499f4eef4bc763868e975acb3e812e61/0ca9f/2023-08-25-09-19-36.webp 384w,\n/static/499f4eef4bc763868e975acb3e812e61/b5bcc/2023-08-25-09-19-36.webp 425w\"\n            sizes=\"(max-width: 425px) 100vw, 425px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/499f4eef4bc763868e975acb3e812e61/b5bcc/2023-08-25-09-19-36.webp\"\n            alt=\"2023 08 25 09 19 36\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그 다음은 버튼을 눌러줍니다!\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/39897e9ce9941e7cdf72ae3972618bf1/f4b45/2023-08-25-09-27-28.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.91666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRmIAAABXRUJQVlA4IFYAAACwAwCdASoUAA8APtFYpEwoJSOiMAgBABoJaQAAW+jH0x7xeMoUAAD+9g81UzyUC1c3oxSKBkTxyjZGAm48DSmPIttNtqh1UipvopkeevFO9FvYgQAAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39897e9ce9941e7cdf72ae3972618bf1/a59e9/2023-08-25-09-27-28.webp 192w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/0ca9f/2023-08-25-09-27-28.webp 384w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/dc9b9/2023-08-25-09-27-28.webp 768w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/e2c2f/2023-08-25-09-27-28.webp 1152w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/f4b45/2023-08-25-09-27-28.webp 1473w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39897e9ce9941e7cdf72ae3972618bf1/a59e9/2023-08-25-09-27-28.webp 192w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/0ca9f/2023-08-25-09-27-28.webp 384w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/dc9b9/2023-08-25-09-27-28.webp 768w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/e2c2f/2023-08-25-09-27-28.webp 1152w,\n/static/39897e9ce9941e7cdf72ae3972618bf1/f4b45/2023-08-25-09-27-28.webp 1473w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39897e9ce9941e7cdf72ae3972618bf1/dc9b9/2023-08-25-09-27-28.webp\"\n            alt=\"2023 08 25 09 27 28\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그러면 Secret키를 등록할 수 있습니다.<br>\n여기에 이제 AWS SSH 키와 연결할 AWS HOST를 등록시켜주면 됩니다!\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a6480e87bfc5058cc43daffb44092f21/096fc/2023-08-25-09-29-50.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRj4AAABXRUJQVlA4IDIAAACwAgCdASoUAAsAPtFUo0uoJKMhsAgBABoJaQAAeyAA/vKaoolIWg1+D9G/IIlnYXQAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a6480e87bfc5058cc43daffb44092f21/a59e9/2023-08-25-09-29-50.webp 192w,\n/static/a6480e87bfc5058cc43daffb44092f21/0ca9f/2023-08-25-09-29-50.webp 384w,\n/static/a6480e87bfc5058cc43daffb44092f21/dc9b9/2023-08-25-09-29-50.webp 768w,\n/static/a6480e87bfc5058cc43daffb44092f21/096fc/2023-08-25-09-29-50.webp 1065w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a6480e87bfc5058cc43daffb44092f21/a59e9/2023-08-25-09-29-50.webp 192w,\n/static/a6480e87bfc5058cc43daffb44092f21/0ca9f/2023-08-25-09-29-50.webp 384w,\n/static/a6480e87bfc5058cc43daffb44092f21/dc9b9/2023-08-25-09-29-50.webp 768w,\n/static/a6480e87bfc5058cc43daffb44092f21/096fc/2023-08-25-09-29-50.webp 1065w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a6480e87bfc5058cc43daffb44092f21/dc9b9/2023-08-25-09-29-50.webp\"\n            alt=\"2023 08 25 09 29 50\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Git Action은 Yaml 파일을 통해 설정합니다.<br>\n.github/workflows 폴더 아래 파일이 위치해야 Github에서 워크플로우로 인식을 하도록 약속이 돼 있습니다!<br>\n이제 .github/workflows에 하나의 yaml 파일을 등록해 줍니다.<br>\n내용은 아래처럼 작성하시면 push 했을 때나 PR이 Closed 되었을 때 동작합니다.</p>\n<div class=\"code-header\">\n\t<span class=\"red btn\"></span>\n\t<span class=\"yellow btn\"></span>\n\t<span class=\"green btn\"></span>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> CI to AWS EC2 Airflow\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"main\"</span> <span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>closed<span class=\"token punctuation\">]</span>\n\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Send to ec2<span class=\"token punctuation\">-</span>airflow\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SSH Commands\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> appleboy/ssh<span class=\"token punctuation\">-</span>action@v1.0.0\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_SSH_HOST <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> ec2<span class=\"token punctuation\">-</span>user\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_SSH_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">22</span>\n          <span class=\"token key atrule\">script_stop</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">command_timeout</span><span class=\"token punctuation\">:</span> 200m\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            cd ~/your-airflow-repository\n            sudo chown -R $USER:$USER .\n            git pull origin main\n            docker-compose down\n            docker-compose up -d</span>\n      <span class=\"token comment\"># 이 부분은 슬랙이라 추가적으로 슬랙으로 배포를 열람받고 싶은 분은 WEBHOOK 등록해서 쓰시면 됩니다.</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> action<span class=\"token punctuation\">-</span>slack\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> 8398a7/action<span class=\"token punctuation\">-</span>slack@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">status</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> job.status <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">author_name</span><span class=\"token punctuation\">:</span> 배포 결과\n          <span class=\"token key atrule\">fields</span><span class=\"token punctuation\">:</span> repo<span class=\"token punctuation\">,</span>message<span class=\"token punctuation\">,</span>commit<span class=\"token punctuation\">,</span>author<span class=\"token punctuation\">,</span>action<span class=\"token punctuation\">,</span>eventName<span class=\"token punctuation\">,</span>workflow\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">SLACK_WEBHOOK_URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.SLACK_WEBHOOK_URL <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># required</span>\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> always()</code></pre></div>\n<p>이렇게 Git Action을 통해 배포 자동화를 해보았습니다.<br>\n보통 개발을 하실 때 로컬에서 개발하시고 실제 서버에 배포하실텐데요.<br>\n보통 개발 하시는 구조가 이럴 것이라고 생각해서 한 번 만들어봤습니다!<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36ae084ee11fba7eae484a7f693f97e3/c25ec/2023-08-25-11-20-02.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.10416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRm4AAABXRUJQVlA4IGIAAADQAwCdASoUAAgAPtFWpEuoJKOhsAgBABoJZwBTAFvGN/UPvIJKDAAA/vT0rTiMak6ooGwbP8emB8yGPuYbHmOATezDu2VdJdaFWm+Yv7FEmhKE1zjA91T/CxKBVDX51xYAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/36ae084ee11fba7eae484a7f693f97e3/a59e9/2023-08-25-11-20-02.webp 192w,\n/static/36ae084ee11fba7eae484a7f693f97e3/0ca9f/2023-08-25-11-20-02.webp 384w,\n/static/36ae084ee11fba7eae484a7f693f97e3/dc9b9/2023-08-25-11-20-02.webp 768w,\n/static/36ae084ee11fba7eae484a7f693f97e3/e2c2f/2023-08-25-11-20-02.webp 1152w,\n/static/36ae084ee11fba7eae484a7f693f97e3/f3efb/2023-08-25-11-20-02.webp 1536w,\n/static/36ae084ee11fba7eae484a7f693f97e3/c25ec/2023-08-25-11-20-02.webp 1797w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/36ae084ee11fba7eae484a7f693f97e3/a59e9/2023-08-25-11-20-02.webp 192w,\n/static/36ae084ee11fba7eae484a7f693f97e3/0ca9f/2023-08-25-11-20-02.webp 384w,\n/static/36ae084ee11fba7eae484a7f693f97e3/dc9b9/2023-08-25-11-20-02.webp 768w,\n/static/36ae084ee11fba7eae484a7f693f97e3/e2c2f/2023-08-25-11-20-02.webp 1152w,\n/static/36ae084ee11fba7eae484a7f693f97e3/f3efb/2023-08-25-11-20-02.webp 1536w,\n/static/36ae084ee11fba7eae484a7f693f97e3/c25ec/2023-08-25-11-20-02.webp 1797w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/36ae084ee11fba7eae484a7f693f97e3/dc9b9/2023-08-25-11-20-02.webp\"\n            alt=\"2023 08 25 11 20 02\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<div class=\"source\"> 현재 구축한 인프라 </div>\n<p>제 포스팅이 Airflow를 사용하시는 분들에게 도움이 됐으면 좋겠네요!</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84%EC%97%90\">들어가기 전에</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%ED%95%9C-%EA%B8%80\">참고한 글</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#docker-compose%EB%A1%9C-airflow-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\">Docker compose로 Airflow 설치하기</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#amazon-linux2-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-docker-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\">Amazon linux2 환경에서 Docker 설치하기</a></li>\n<li><a href=\"#amazon-linux2%EC%97%90%EC%84%9C-docker-compose-%EC%84%A4%EC%B9%98\">Amazon linux2에서 Docker Compose 설치</a></li>\n<li><a href=\"#github-repository%EB%A5%BC-%ED%95%98%EB%82%98-%EC%83%9D%EC%84%B1\">Github Repository를 하나 생성</a></li>\n<li><a href=\"#amazon-linux2%EC%97%90-docker-compose%EB%A1%9C-airflow-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0\">Amazon-linux2에 Docker-compose로 Airflow 설치하기</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#git-action-%EB%B0%B0%ED%8F%AC-%EC%9E%90%EB%8F%99%ED%99%94\">Git Action 배포 자동화</a></p>\n</li>\n</ul>","frontmatter":{"title":"Amazon-linux2 Docker Compose Airflow 설치와 Git Action 배포 자동화","summary":"으어어.. 에러가 났떤 지난날들","date":"2023.08.01.","categories":["Airflow"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRvwAAABXRUJQVlA4IPAAAACwBQCdASoUABQAAAAAJaQDLs2AOAA6RjyVZ4AcyT+M2igZIByhf9q/KHjK/0zOzXrCCarYswAA/v//vi4vw/8C9ZQ7H+H//yCwbQPvsZtVP/0ES//obRwOWqfhB6QluKlBWVv/00//+CZuyt2HnR8rj3PH4g+AF7BjHL/DERmaNf+iMa2Vn/8w5vZ6J8f/zWL84nce2QIW+sKRZGr/3/++a+72/AQG7P0f+Vx+2n8ZbXOmM113LcubNJdYTmvhHp8ioh/Ssay6McI8Hv4WzVhoxfjdbd0Vnn7uGhnuuiz+QfZ5Lvn/yafX9rRFNCCAAAA="},"images":{"fallback":{"src":"/static/97afc7f825b0ddb0803e2cd1be787df7/9c0a1/chocoball.webp","srcSet":"/static/97afc7f825b0ddb0803e2cd1be787df7/e64f1/chocoball.webp 100w,\n/static/97afc7f825b0ddb0803e2cd1be787df7/8b00d/chocoball.webp 200w,\n/static/97afc7f825b0ddb0803e2cd1be787df7/9c0a1/chocoball.webp 400w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[]},"width":400,"height":400}},"publicURL":"/static/97afc7f825b0ddb0803e2cd1be787df7/chocoball.webp"}}}}]}},"pageContext":{"slug":"/airflow/install_deploy/"}},"staticQueryHashes":["2269898903"],"slicesMap":{}}